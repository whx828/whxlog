import{r as x,R as u,u as R,f as D,a as O,j as m,b as P,c as B,p as E,d as K,k as $,e as _,g as W}from"./vendor.9e8dfab1.js";const j=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerpolicy&&(r.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?r.credentials="include":o.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}};j();const F="1.0.0",G={id:"_pengx17-logseq-tabs"},U=()=>{const e=R(),[t,n]=u.useState("light");return u.useEffect(()=>(n(top.document.querySelector("html")?.getAttribute("data-theme")??(matchMedia("prefers-color-scheme: dark").matches?"dark":"light")),logseq.App.onThemeModeChanged(s=>{e()&&n(s.mode)})),[e]),t};async function z(e){if(!e)return null;const t=await logseq.Editor.getPage(e);if(t&&t.alias?.length>0){const s=(await logseq.DB.datascriptQuery(`
      [:find (pull ?p [*])
      :where
      [?a :block/name "${t?.name}"]
      [?p :block/alias ?a]]
    `)).flat().find(o=>o.properties?.alias?.some(r=>r.toLowerCase()===t?.name));if(s)return await logseq.Editor.getPage(s.name)}return t}const H=e=>new Promise(t=>setTimeout(t,e));function C(e){return"logseq-plugin-tabs:"+F+"/"+e}const V=e=>{const t=localStorage.getItem(C(e));if(t)try{return JSON.parse(t)}catch{}return null},J=(e,t)=>{localStorage.setItem(C(t),JSON.stringify(e))};function Q(){const[e,t]=x.exports.useState(null),n=async()=>{const s=await logseq.App.getCurrentGraph();t(s?.path??null)};return u.useEffect(()=>(n(),logseq.App.onCurrentGraphChanged(()=>{n()})),[]),e}function X(){const[e,t]=u.useState([]),n=Q();return u.useEffect(()=>{if(n){const o=V(n);t(o??[])}},[n]),[e,o=>{if(n&&!D(e,o))return J(o,n),t(o)}]}function Y(e,t){let n=null;return(...s)=>{n&&clearTimeout(n),n=window.setTimeout(()=>{e(...s),n=null},t)}}function Z(e,t=300){const n=b(e);return x.exports.useMemo(()=>Y(n,t),[n,t])}function ee(e,t){const n=u.useRef(document.documentElement),s=O(n);u.useEffect(()=>{logseq.showMainUI();const o=top.document.querySelector("#head.cp__header"),r=top.document.querySelector("#main-content-container"),i=()=>{const{left:v,width:T}=r.getBoundingClientRect(),a=T-10;logseq.setMainUIInlineStyle({zIndex:9,userSelect:"none",position:"fixed",left:`${v}px`,top:`${o.offsetHeight+2}px`,height:e?"28px":"0px",width:s?"100%":t+"px",maxWidth:a+"px"})};i();const p=new ResizeObserver(i);return p.observe(r),()=>{p.disconnect()}},[e,t,s])}const I=()=>navigator.userAgent.includes("Mac");function b(e){const t=u.useRef();return u.useLayoutEffect(()=>{t.current=e}),u.useCallback((...n)=>t.current.apply(void 0,n),[])}const te=e=>{const[t,n]=u.useState();return u.useEffect(()=>{const s=()=>n(e.current?.scrollWidth||0),o=new MutationObserver(()=>{s(),setTimeout(s,100),setTimeout(s,200),setTimeout(s,300)});return e.current&&(n(e.current.scrollWidth||0),o.observe(e.current,{childList:!0,subtree:!0,attributes:!0})),()=>o.disconnect()},[e]),t},ne=e=>{top?.document.querySelector("#main-container")?.scrollTo(e)},q=e=>Boolean(e.page),oe=()=>{u.useEffect(()=>{let e=0;const t=()=>{setTimeout(()=>{window.document.hasFocus()&&top.focus()})};return e=setInterval(t,1e3),window.addEventListener("focus",t),()=>{window.removeEventListener("focus",t),clearInterval(e)}})},se=()=>m("svg",{height:"1em",width:"1em",viewBox:"0 0 122.878 122.88",fill:"currentColor",children:m("g",{children:m("path",{d:"M1.426,8.313c-1.901-1.901-1.901-4.984,0-6.886c1.901-1.902,4.984-1.902,6.886,0l53.127,53.127l53.127-53.127 c1.901-1.902,4.984-1.902,6.887,0c1.901,1.901,1.901,4.985,0,6.886L68.324,61.439l53.128,53.128c1.901,1.901,1.901,4.984,0,6.886 c-1.902,1.902-4.985,1.902-6.887,0L61.438,68.326L8.312,121.453c-1.901,1.902-4.984,1.902-6.886,0 c-1.901-1.901-1.901-4.984,0-6.886l53.127-53.128L1.426,8.313L1.426,8.313z"})})});function h(e,t){function n(s,o){return s!=null&&o!=null&&s.toLowerCase()===o.toLowerCase()}return e?.page||t?.page?n(e?.uuid,t?.uuid):Boolean(n(e?.originalName,t?.originalName)||n(e?.name,t?.name)||e?.alias?.includes(t?.id))}const re=u.forwardRef(({activePage:e,onClickTab:t,tabs:n,onCloseTab:s,onPinTab:o,onSwapTab:r},i)=>{const[p,v]=u.useState();u.useEffect(()=>{const a=()=>{v(void 0)};return document.addEventListener("dragend",a),()=>{document.removeEventListener("dragend",a)}},[]);const T=Z(r,0);return m("div",{ref:i,"data-dragging":p!=null,className:"flex items-center h-full px-1",style:{width:"fit-content"},children:n.map(a=>{const w=h(a,e),S=c=>{c.stopPropagation(),s(a)},d=c=>{p&&(c.preventDefault(),c.dataTransfer.dropEffect="move",T(a,p))},f=c=>{c.dataTransfer.effectAllowed="move",v(a)},l=a.properties?.emoji?a.properties?.emoji:q(a)?"B":"P";return P("div",{onClick:()=>t(a),onDoubleClick:()=>o(a),"data-active":w,"data-pinned":a.pinned,"data-dragging":p===a,draggable:!0,onDragOver:d,onDragStart:f,className:"logseq-tab group",children:[m("div",{className:"text-xs rounded border mr-1 px-1 inline light:bg-white dark:bg-dark",children:l}),P("span",{className:"logseq-tab-title",children:[a.originalName??a.name," ",q(a)&&`/ ${a.uuid?.substring(a.uuid.length-12)}`]}),a.pinned?m("span",{children:"\u{1F4CC}"}):m("button",{className:"close-button",onClick:S,children:m(se,{})})]},a.uuid??a.name)})})});function ie(e){const t=e;return t.tagName==="A"&&t.hasAttribute("data-ref")&&(t.className.includes("page-ref")||t.className.includes("tag"))}function A(e){return e.getAttribute("blockid")??e.querySelector("[blockid]")?.getAttribute("blockid")}function ce(e){u.useEffect(()=>{const t=async n=>{const s=n.composedPath()[0];if(I()?n.metaKey:n.ctrlKey){let r=null;if(ie(s)){n.stopPropagation(),n.stopImmediatePropagation();const i=await z(s.getAttribute("data-ref"));i&&(r=i)}else if(A(s)){n.stopPropagation(),n.stopImmediatePropagation();const i=A(s);if(i){const p=await logseq.Editor.getBlock(i);if(p){const v=await logseq.Editor.getPage(p?.page.id);v&&(r={...v,...p})}}}r&&e(r,n.shiftKey)}};return top?.document.addEventListener("mousedown",t,!0),()=>{top?.document.removeEventListener("mousedown",t,!0)}},[e])}function ae(e){const[t,n]=u.useState(null),s=u.useRef(t),o=b(async()=>{const r=await logseq.Editor.getCurrentPage();let i=null;r&&(i=e.find(p=>h(p,r))??null,i||(i=await logseq.Editor.getPage(r.name??r?.page.id)),i={...i,...r},i.scrollTop&&ne({top:i.scrollTop}),s.current=i),n(i)});return u.useEffect(()=>logseq.App.onRouteChanged(o),[o]),u.useEffect(()=>{let r=!1;async function i(){await H(1500),!s.current&&!r&&(await o(),await i())}return i(),()=>{r=!0}},[o]),[t,n]}const L=e=>{e.sort((t,n)=>t.pinned&&!n.pinned?-1:!t.pinned&&n.pinned?1:0)};function ue(){const[e,t]=X(),[n,s]=ae(e),o=u.useRef(),r=B(e),i=b((d,f)=>{const l=e.findIndex(g=>h(g,d));if(e[l]?.pinned&&!f)return;const c=[...e];if(c.splice(l,1),t(c),c.length===0)logseq.App.pushState("home");else if(h(d,n)){const g=c[Math.min(c.length-1,l)];s(g)}}),p=b(async d=>{s(d);const f=e.findIndex(l=>h(l,o.current));if(f!==-1){const l=top?.document.querySelector("#main-container")?.scrollTop;t(E(e,c=>{c[f].scrollTop=l}))}}),v=b((d,f=!1)=>{d&&(e.every(l=>!h(d,l))?t([...e,d]):f=!0,f&&p(d))});ce(v),K(()=>{let d=0,f=r.current;const l=o.current;return n&&(f=E(e,c=>{if(e.every(g=>!h(g,n))){const g=c.findIndex(N=>h(N,l)),y=c[g]?.pinned;g===-1||y?c.push(n):c[g]=n}else{const g=c.findIndex(y=>h(y,n));c[g]=n}}),d=setTimeout(async()=>{const c=await logseq.Editor.getCurrentPage();h(n,c)||logseq.App.pushState("page",{name:q(n)?n.uuid:n.originalName??n.name})},200)),o.current=n,t(f),()=>{d&&clearTimeout(d)}},[n??{}]);const T=b(d=>{t(E(e,f=>{const l=f.findIndex(c=>h(c,d));f[l].pinned=!f[l].pinned,L(f)}))}),a=(d,f)=>{t(E(e,l=>{const c=l.findIndex(y=>h(y,d)),g=l.findIndex(y=>h(y,f));l[c]=f,l[g]=d,L(l)}))};u.useEffect(()=>{const d=new $.Keyboard(top);d.setLocale("us",_);const f=c=>{c.stopPropagation(),c.preventDefault(),o.current&&i(o.current)},l=I()?"command + w":"ctrl + w";return d.bind(l,f),()=>{d.unbind(l,f)}},[i]);const w=u.useRef(null),S=te(w);return ee(e.length>0,S),u.useEffect(()=>{n&&w&&setTimeout(()=>{w.current?.querySelector('[data-active="true"]')?.scrollIntoView({behavior:"smooth"})},100)},[n,w]),m(re,{ref:w,onClickTab:p,activePage:n,tabs:e,onSwapTab:a,onPinTab:T,onCloseTab:i})}function le(){const e=U();return oe(),m("main",{style:{width:"100vw",height:"100vh"},className:`${e}`,children:m(ue,{})})}const k=`__${G.id}__loaded__`;function M(){const e=logseq.baseInfo.id;console.info(`#${e}: MAIN`),W.render(m(u.StrictMode,{children:m(le,{})}),document.getElementById("app")),top[k]=!0,console.info(`#${e}: MAIN DONE`)}top[k]?logseq.App.relaunch().then(M).catch(console.error):logseq.ready(M).catch(console.error);
