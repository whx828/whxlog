import{d as e,c as t,a,i as n,r as o,o as r,b as s,e as i,f as l,m as d,g as c,h as p,j as u}from"./vendor.14a6fe0b.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}(),e.extend(t),e.extend(a),e.extend(n);const g={name:"App",data(){const e=new Date;return{ready:!1,preferredDateFormat:null,journals:null,opts:{color:"orange","is-dark":!1,attributes:[{dot:!0,dates:[]},{key:"today",highlight:!0,dates:new Date}]},mDate:{month:e.getMonth()+1,year:e.getFullYear()}}},mounted(){logseq.App.onThemeModeChanged((({mode:e})=>{this.opts["is-dark"]="dark"===e}));const e=()=>logseq.App.getUserConfigs().then((e=>{e.preferredDateFormat&&(this.preferredDateFormat=e.preferredDateFormat)}));this.$watch("mDate",(()=>{this._updateCalendarInMonth()}),{immediate:!0}),logseq.on("ui:visible:changed",(({visible:t})=>{t&&(this.ready=!0,e())}))},methods:{async _updateCalendarInMonth(){const t=await this._getCurrentRepoRangeJournals();this.journals=t.reduce(((e,t)=>(e[t["journal-day"].toString()]=t,e)),{}),console.debug("[query journals]",t);const a=t.map((t=>{const a=e(t["journal-day"].toString());if(a.isValid()&&!a.isToday())return a.toDate()}));this.opts.attributes[0]={dot:!0,dates:a},this.opts.attributes=[...this.opts.attributes]},_onToPage(e){this.mDate=e},async _getCurrentRepoRangeJournals(){const{month:e,year:t}=this.mDate,a=t+(e<10?"0":"")+e;let n;try{n=await logseq.DB.datascriptQuery(`\n          [:find (pull ?p [*])\n           :where\n           [?b :block/page ?p]\n           [?p :block/journal? true]\n           [?p :block/journal-day ?d]\n           [(>= ?d ${a}01)] [(<= ?d ${a}31)]]\n        `)}catch(o){console.error(o)}return(n||[]).flat()},_onClickOutside({target:e}){!e.closest(".calendar-inner")&&logseq.hideMainUI()},_onDaySelect({id:t}){this.date=t;let a=t,n=t.replaceAll("-","");if(this.journals.hasOwnProperty(n))a=this.journals[n]["original-name"];else if(this.preferredDateFormat){const n=this.preferredDateFormat.replace("yyyy","YYYY").replace("dd","DD").replace("do","Do").replace("EEEE","dddd").replace("EEE","ddd").replace("EE","dd").replace("E","dd");a=e(t).format(n)}logseq.hideMainUI(),logseq.App.pushState("page",{name:a})}}},h={class:"calendar-inner"};g.render=function(e,t,a,n,p,u){const g=o("v-calendar");return r(),s("div",{class:"calendar-wrap",onClick:t[0]||(t[0]=(...e)=>u._onClickOutside&&u._onClickOutside(...e))},[i("div",h,[p.ready?(r(),l(g,d({key:0,ref:"calendar",onDayclick:u._onDaySelect,"onUpdate:toPage":u._onToPage},p.opts),null,16,["onDayclick","onUpdate:toPage"])):c("",!0)])])};logseq.ready({openCalendar(e){const{rect:t}=e,a=document.querySelector(".calendar-inner");console.log(t),Object.assign(a.style,{top:`${t.top+30}px`,left:t.left-115+"px"}),logseq.showMainUI()}}).then((function(){logseq.setMainUIInlineStyle({position:"fixed",zIndex:11});const e=logseq.baseInfo.id;logseq.provideStyle(`\n    div[data-injected-ui=open-calendar-${e}] {\n      display: flex;\n      align-items: center;\n      font-weight: 500;\n      position: relative;\n    }\n  `),logseq.App.registerUIItem("toolbar",{key:"open-calendar",template:'\n      <a class="button" \n      data-on-click="openCalendar"\n      data-rect>\n       <i class="ti ti-calendar-event"></i> \n      </a>\n    '}),p(g).use(u,{}).mount("#app")}));
